{% extends "base.html" %}
{% block title %}æˆ‘çš„æŠ•ç¨¿ â€” å¤ªé¼“æŠ•ç¨¿{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header animate-in">
        <h1>ğŸ“‹ æˆ‘çš„æŠ•ç¨¿</h1>
        <p>æŸ¥çœ‹ä½ çš„æ‰€æœ‰æŠ•ç¨¿åŠå®¡æ ¸çŠ¶æ€</p>
    </div>

    <!-- Stats -->
    <div class="stats-row animate-in" style="animation-delay:0.05s;">
        {% set total = submissions.total %}
        {% set pending = current_user.submissions.filter_by(status='pending').count() %}
        {% set approved = current_user.submissions.filter_by(status='approved').count() %}
        {% set rejected = current_user.submissions.filter_by(status='rejected').count() %}
        <div class="stat-card">
            <div class="stat-value">{{ total }}</div>
            <div class="stat-label">æ€»æŠ•ç¨¿</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ pending }}</div>
            <div class="stat-label">å®¡æ ¸ä¸­</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ approved }}</div>
            <div class="stat-label">å·²é€šè¿‡</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ rejected }}</div>
            <div class="stat-label">æœªé€šè¿‡</div>
        </div>
    </div>

    {% if submissions.items %}
    <div class="table-wrapper animate-in" style="animation-delay:0.1s;">
        <table>
            <thead>
                <tr>
                    <th>æ›²å</th>
                    <th>åˆ†ç±»</th>
                    <th>çŠ¶æ€</th>
                    <th>ä¸Šä¼ æ—¶é—´</th>
                    <th>å®¡æ ¸å¤‡æ³¨</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody>
                {% for sub in submissions.items %}
                <tr>
                    <td>
                        <strong>{{ sub.title }}</strong>
                        {% if sub.artist %}<br><span style="color:var(--text-muted);font-size:0.78rem;">{{ sub.artist
                            }}</span>{% endif %}
                    </td>
                    <td><span class="card-badge badge-category">{{ sub.song_type }}</span></td>
                    <td>
                        <span class="card-badge badge-{{ sub.status }}">{{ sub.status_text }}</span>
                    </td>
                    <td style="font-size:0.8rem; color:var(--text-muted);">
                        {{ sub.created_at.strftime('%Y-%m-%d %H:%M') }}
                    </td>
                    <td style="font-size:0.8rem; color:var(--text-secondary); max-width:200px;">
                        {{ sub.review_note or 'â€”' }}
                    </td>
                    <td>
                        {% if sub.status == 'pending' %}
                        <form method="POST" action="{{ url_for('cancel_submission', sid=sub.id) }}"
                            style="display:inline;" onsubmit="return confirm('ç¡®å®šå–æ¶ˆæ­¤æŠ•ç¨¿ï¼Ÿ')">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button type="submit" class="btn btn-danger btn-sm">å–æ¶ˆ</button>
                        </form>
                        {% elif sub.status == 'approved' %}
                        <a href="{{ url_for('submission_detail', sid=sub.id) }}" class="btn btn-outline btn-sm">æŸ¥çœ‹</a>
                        {% else %}
                        <span style="color:var(--text-muted);">â€”</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    {% if submissions.pages > 1 %}
    <div class="pagination">
        {% if submissions.has_prev %}
        <a href="{{ url_for('dashboard', page=submissions.prev_num) }}">â€¹</a>
        {% else %}
        <span class="disabled">â€¹</span>
        {% endif %}

        {% for p in submissions.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
        {% if p %}
        <a href="{{ url_for('dashboard', page=p) }}" class="{% if p == submissions.page %}active-page{% endif %}">{{ p
            }}</a>
        {% else %}
        <span style="color:var(--text-muted);">â€¦</span>
        {% endif %}
        {% endfor %}

        {% if submissions.has_next %}
        <a href="{{ url_for('dashboard', page=submissions.next_num) }}">â€º</a>
        {% else %}
        <span class="disabled">â€º</span>
        {% endif %}
    </div>
    {% endif %}

    {% else %}
    <div class="empty-state animate-in" style="animation-delay:0.1s;">
        <span class="icon">ğŸ“­</span>
        <p>ä½ è¿˜æ²¡æœ‰æŠ•ç¨¿è¿‡è°±é¢</p>
        <a href="{{ url_for('upload') }}" class="btn btn-primary">å»æŠ•ç¨¿</a>
    </div>
    {% endif %}
</div>
{% endblock %}